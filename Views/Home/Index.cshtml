@inject IEnumerable<City> Cities

@{
    ViewData["Title"] = "گراف شبکه";
}

<h1>گراف شبکه</h1>

<div class="row mt-5">
    <div class="col-lg-3 col-sm-6 form-group">
        <label class="control-label">شهر</label>
        <select id="City" class="form-control">
            @foreach (var city in Cities)
            {
                <option value="@city.Id.ToString()">@city.Name</option>
            }
        </select>
    </div>
    <div class="col-lg-3 col-sm-6 form-group">
        <label class="control-label">مرکز</label>
        <select id="Center" class="form-control"></select>
    </div>
</div>
<div class="mt-2">
    <button id="btnShowGraph" class="btn btn-primary">نمایش گراف</button>
</div>

<div id="divResult" class="d-none mt-5">
    <p class="mt-4">توجه: برای رفتن به جزئیات هر کدام از اشکال موجود، روی آن دوبار کلیک کنید.</p>
    <p class="mb-4">توجه: برای زوم کردن، موس را روی گراف نگه داشته، دکمه <kbd>Ctrl</kbd> را نگه داشته و اسکرول موس را بچرخانید.</p>
    <div id="divGraph" style="border: solid 1px black; height: 600px; margin-left:-2em; margin-right:-2em;"></div>
</div>


@section Scripts {
    <script src="~/lib/gojs/go.js"></script>
    <script src="~/js/go-init.js" asp-append-version="true"></script>
    <script>
        $(window).ready(function () {
            var city = $("#City").val();
            if (city) {
                $("#City").triggerHandler("change");
            }
        });

        $("#City").change(function () {
            removeOptionsOfDropDown($("#Center"), null);
            var id = $(this).val();
            $.get("/Place/Centers?city=" + id, function (res) {
                $.each(res, function (index, item) {
                    $("#Center").append("<option value='" + item.id + "'>" + item.text + "</option>");
                });
                //$("#Center").select2(select2BaseSettings);

            });
        });

        var diagram = null;
        $("#btnShowGraph").click(function () {
            $("#divResult").removeClass("d-none");
            $.get("/Connection/Graph?Center=" + $("#Center").val(), function (res) {
                diagram = initGojs("divGraph", res);
            });
        });

    </script>
}